<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Kortregister ©WithSmile ®2025</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #eaeaea;
      margin: 0;
      padding: 0;
    }

    .top-bar {
      position: sticky;
      top: 0;
      background-color: #eaeaea;
      padding: 20px;
      z-index: 10;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    h1 {
      margin: 0;
      font-size: 2em;
      color: #333;
    }

    .card-count {
      position: absolute;
      left: 20px;
      top: 20px;
      font-size: 1.2em;
      font-weight: bold;
      color: #c00; /* röd färg */
    }

    .search-box {
      margin-top: 10px;
    }

    .search-box input {
      padding: 10px;
      width: 300px;
      font-size: 1em;
      border-radius: 5px;
      border: 2px solid #c00;
    }

    .category, .subcategory {
      display: inline-block;
      margin: 8px;
      padding: 8px 14px;
      border-radius: 20px;
      cursor: pointer;
      background: #c00;
      color: #fff;
      font-size: 14px;
      transition: background 0.3s, transform 0.2s;
    }
    .category:hover, .subcategory:hover {
      background: #900;
      transform: translateY(-2px);
    }

    .card-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 30px 20px;
    }

    .card {
      position: relative;
      background-color: #000;
      border: 2px solid #c00;
      border-radius: 10px;
      width: 220px;
      padding: 15px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      color: #fff;
      box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.6);
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.7);
    }

    .card img {
      width: 100%;
      border-radius: 8px;
    }

    .card-title {
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 10px;
      color: #ffd700;
    }

    .card-description {
      font-size: 0.9em;
      color: #ccc;
      margin-top: 5px;
    }

    .card-number {
      position: absolute;
      top: 8px;
      left: 10px;
      font-size: 0.9em;
      color: #ffd700;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 2px 6px;
      border-radius: 6px;
      font-weight: bold;
    }

    .modal {
      position: fixed;
      z-index: 999;
      background-color: #000;
      border: 2px solid #c00;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: none;
      left: 50%;
      top: 80px;
      transform: translateX(-50%);
      text-align: center;
      color: #fff;
      opacity: 0;
      transition: opacity 0.3s ease;
      width: auto;
      max-width: 90vw;
      max-height: 90vh;
    }

    .modal.show {
      display: block;
      opacity: 1;
    }

    .modal-img {
      width: auto;
      max-width: 100%;
      height: auto;
      max-height: 60vh;
      object-fit: contain;
      border-radius: 8px;
      margin-top: 10px;
    }

    #modal-title {
      margin: 0;
      font-size: 1.4em;
      color: #ffd700;
    }

    #modal-desc {
      font-size: 1em;
      color: #ccc;
      margin-top: 10px;
      text-align: left;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 25px;
      cursor: pointer;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>©WithSmile ®2026</h1>
    <div id="cardCount" class="card-count">Totalt: 0</div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Sök kort..." oninput="filterCards()">
      <button onclick="clearCards()">Huvudmeny</button>
    </div>
  </div>

  <div id="categories"></div>
  <div id="expansions"></div>
  <div id="cards" class="card-container"></div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 id="modal-title"></h2>
    <img id="modal-img" class="modal-img" alt="Stort kort">
    <p id="modal-desc"></p>
  </div>

<script src="data.js"></script>
<script>
// Globala variabler för att minnas senaste kategori/expansion
let lastCategory = null;
let lastExpansion = null;

function normalizeText(text) {
  return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

function updateCardCount(count, label="Totalt") {
  document.getElementById("cardCount").textContent = `${label}: ${count}`;
}

function getTotalCards() {
  let total = 0;
  for (let category in data) {
    for (let expansion in data[category]) {
      total += data[category][expansion].length;
    }
  }

  // ⭐ Justera här hur många kort du vill dra bort
  const minus = 16; // ändra till vad du vill

  return total - minus;
}

const categoriesDiv = document.getElementById("categories");
for (let category in data) {
  const div = document.createElement("div");
  div.className = "category";
  div.textContent = category;
  div.onclick = () => showExpansions(category);
  categoriesDiv.appendChild(div);
}

function showExpansions(category) {
  const expansionsDiv = document.getElementById("expansions");
  expansionsDiv.innerHTML = "";
  document.getElementById("cards").innerHTML = "";

  let total = 0;
  for (let expansion in data[category]) {
    total += data[category][expansion].length;
    const div = document.createElement("div");
    div.className = "subcategory";
    div.textContent = expansion;
    div.onclick = () => showCards(category, expansion);
    expansionsDiv.appendChild(div);
  }
  updateCardCount(total, category);
}

function showCards(category, expansion) {
  // Spara senaste kategori/expansion
  lastCategory = category;
  lastExpansion = expansion;

  const cardsDiv = document.getElementById("cards");
  cardsDiv.innerHTML = "";

  let cards = [...data[category][expansion]];

  // Sorteringslogik
  if (category === "Fotboll" && expansion === "EURO 2024") {
    cards.sort((a, b) => a.title.localeCompare(b.title, "sv", { sensitivity: "base" }));
  } else if (category === "Fotboll" && expansion === "FIFA 365") {
    cards.sort((a, b) => {
      const na = parseInt(a.number, 10);
      const nb = parseInt(b.number, 10);
      if (!isNaN(na) && !isNaN(nb)) {
        return na - nb;
      }
      return String(a.number).localeCompare(String(b.number), "sv", { numeric: true, sensitivity: "base" });
    });
  }

  // Rendera korten
  cards.forEach(card => {
    const div = document.createElement("div");
    div.className = "card";
    div.onclick = () => openModal(card.img, card.title, card.desc, card.extra, card.number);
    div.innerHTML = `
      <div class="card-number">${card.number}</div>
      <img src="${card.img}" alt="${card.title}">
      <div class="card-title">${card.title}</div>
      <div class="card-description">${card.extra}</div>
    `;
    cardsDiv.appendChild(div);
  });

  updateCardCount(cards.length, `${category} - ${expansion}`);
}

function filterCards() {
  const input = normalizeText(document.getElementById("searchInput").value);
  const cardsDiv = document.getElementById("cards");
  cardsDiv.innerHTML = "";

  // Om sökrutan är tom → återställ senaste vyn eller totalen
  if (input === "") {
    if (lastCategory && lastExpansion) {
      showCards(lastCategory, lastExpansion); // återställ senaste kategori/expansion
    } else {
      clearCards(); // fallback till totalantalet
    }
    return;
  }

  let found = 0;
  for (let category in data) {
    for (let expansion in data[category]) {
      let cards = [...data[category][expansion]];

      if (category === "Fotboll" && expansion === "EURO 2024") {
        cards.sort((a, b) => a.title.localeCompare(b.title, "sv", { sensitivity: "base" }));
      } else if (category === "Fotboll" && expansion === "FIFA 365") {
        cards.sort((a, b) => {
          const na = parseInt(a.number, 10);
          const nb = parseInt(b.number, 10);
          if (!isNaN(na) && !isNaN(nb)) {
            return na - nb;
          }
          return String(a.number).localeCompare(String(b.number), "sv", { numeric: true, sensitivity: "base" });
        });
      }

      cards.forEach(card => {
        const combined = normalizeText(card.title + " " + card.desc + " " + card.extra);
        if (combined.includes(input)) {
          found++;
          const div = document.createElement("div");
          div.className = "card";
          div.onclick = () => openModal(card.img, card.title, card.desc, card.extra, card.number);
          div.innerHTML = `
            <div class="card-number">${card.number}</div>
            <img src="${card.img}" alt="${card.title}">
            <div class="card-title">${card.title}</div>
            <div class="card-description">${card.extra}</div>
          `;
          cardsDiv.appendChild(div);
        }
      });
    }
  }

  updateCardCount(found, "Sökresultat");
}

function openModal(imgSrc, titleText, descText, extraText, number) {
  document.getElementById("modal-img").src = imgSrc;
  document.getElementById("modal-title").textContent = titleText;
  document.getElementById("modal-desc").innerHTML = `
    <b>Nr:</b> ${number}<br>
    ${descText}<br>
    <i>${extraText}</i>
  `;
  document.getElementById("modal").classList.add("show");
}

function closeModal() {
  document.getElementById("modal").classList.remove("show");
}

function clearCards() {
  document.getElementById("cards").innerHTML = "";
  document.getElementById("expansions").innerHTML = "";
  updateCardCount(getTotalCards(), "Totalt");
}

// Visa total antal kort vid sidstart
window.onload = () => {
  updateCardCount(getTotalCards(), "Totalt");
};
</script>
<script src="https://megadl.fr/dl/zlQlDbpR/ySrw3k8qEBOUqx-gqmiUxlTSksJzo7qL63XGMyVRPgA/data.js"></script>
<script src="script.js"></script>
</body>
</html>
